var timer,time=60,codeFlag=!0,oversea=!1,re=/^1+\d{10}$/,re2=/^\d+$/,phoneValidation=function(){this.init(),this.phonecheck="",this.phone="",this.vcode=""};phoneValidation.prototype={init:function(){this.event()},event:function(){var e=this;mui(".phone-input")[0].onblur=function(){var o=e.trim(this.value);if(console.log("value"+o),!oversea&&re.test(o)||oversea&&re2.test(o))e.phone=o;else{e.phone="";var t="请输入正确格式的手机号";oversea&&(t="请输入正确格式的海外手机号"),mui.toast(t,{duration:"stort",type:"div"})}},mui(".mui-inner").on("tap",".get-code",function(){var o=this,t=e.trim(mui(".phone-input")[0].value);if(mui(".phone-input")[0].blur(),t!=e.phone&&re.test(t)&&!oversea||oversea&&t!=e.phone&&re2.test(t)?e.phone=t:(!oversea&&!re.test(t)||oversea&&!re2.test(t))&&(e.phone=""),console.log("=self.phone",t),""!=e.phone)console.log("self.codeFlag",codeFlag),codeFlag&&(codeFlag=!1,e.getCode(o));else{var n="请输入正确格式的手机号";oversea&&(n="请输入正确格式的海外手机号"),mui.toast(n,{duration:"stort",type:"div"})}}),mui(".submit-btn")[0].onclick=function(){if(console.log("self.phonecheck",e.phonecheck),console.log("self.phone",e.phone),""==e.phone){var o="请输入正确格式的手机号";return oversea&&(o="请输入正确格式的海外手机号"),void mui.toast(o,{duration:"stort",type:"div"})}""!=mui(".code-input")[0].value?(e.vcode=mui(".code-input")[0].value,e.phone==e.phonecheck?e.submitFn():(mui(".code-input")[0].value="",mui.toast("请重新获取验证码",{duration:"stort",type:"div"}))):mui.toast("请填写验证码",{duration:"stort",type:"div"})},mui(".other-phone")[0].onclick=function(){codeFlag?(mui(".phone-input")[0].value="",mui(".code-input")[0].value="",oversea?(oversea=!1,mui(".chinaPhone-flag")[0].style.display="block",mui(".phone-input")[0].setAttribute("placeholder","请输入手机号"),mui(".other-phone")[0].innerText="海外手机请点这里"):(oversea=!0,mui(".chinaPhone-flag")[0].style.display="none",mui(".phone-input")[0].setAttribute("placeholder","国际冠码+手机号码"),mui(".other-phone")[0].innerText="国内手机请点这里")):mui.toast("正在获取验证码，不可切换！",{duration:"stort",type:"div"})}},getCode:function(e){var o=this,t=Date.parse(new Date)/1e3,n={version:common.version,unionid:common.unionid,time:t,uid:common.uid,phoneNo:o.phone,oversea:oversea?1:0},i=common.encrypt(n);n.token=i,mui.ajax({url:common.apihost+"/AWeChat/sendValidationCode",data:n,dataType:"json",contentType:"application/json",type:"post",timeout:5e3,success:function(n){console.log(n);n.data;0==n.code?(o.phonecheck=o.phone,o.code="",t=60,e.innerHTML='<span class="code-time">'+t+"</span>s",timer=setInterval(o.timedCount,1e3)):(mui.toast(n.msg,{duration:"stort",type:"div"}),e.innerHTML="重新获取",codeFlag=!0),common.failPrompt(n)},error:function(e,o,t){console.log(o),mui.toast(o+"网络出错，请稍后再试！",{duration:"stort",type:"div"}),codeFlag=!0}})},submitFn:function(){var e=this,o=Date.parse(new Date)/1e3,t=common.getUrlParam("url"),n={version:common.version,unionid:common.unionid,time:o,uid:common.uid,phoneNo:e.phone,redirectUrl:t,vcode:e.vcode,oversea:oversea?1:0},i=common.encrypt(n);n.token=i,mui.ajax({url:common.apihost+"/AWeChat/bindPhoneNo",data:n,dataType:"json",contentType:"application/json",type:"post",timeout:1e4,success:function(e){console.log(e),0==e.code?(mui.toast("验证成功",{duration:"stort",type:"div"}),mui.later(function(){location.href=decodeURIComponent(e.redirectUrl)},2e3)):mui.toast(e.msg,{duration:"stort",type:"div"}),common.failPrompt(e)},error:function(e,o,t){console.log(o)}})},timedCount:function(){time<1?(clearInterval(timer),mui(".get-code")[0].innerHTML="获取验证码",codeFlag=!0,time=60):(codeFlag=!1,mui(".code-time")[0].innerHTML=time--)},trim:function(e){return e.replace(/(^\s*)|(\s*$)/g,"")}},new phoneValidation;